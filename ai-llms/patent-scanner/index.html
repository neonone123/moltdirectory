<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Describe your concept and discover what makes it distinctive">
  <title>patent-scanner - OpenClaw Directory</title>
  <link rel="canonical" href="https://moltdirectory.com/ai-llms/patent-scanner/">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶û</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    // Apply saved theme before page renders to prevent flash
    (function() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      if (savedTheme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo">

        <span class="logo-text">OpenClaw Directory</span>
      </a>
      <nav class="header-links">
        <a href="/start-here/" class="header-link">Start Here</a>
        <a href="/security-auditor" class="header-link">Security Auditor</a>
        <a href="https://github.com/neonone123/moltdirectory/issues/new?template=add-skill.yml" class="header-link" target="_blank" rel="noopener">Add Skill</a>
        <button class="theme-toggle" aria-label="Toggle theme" onclick="toggleTheme()">
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
        <a href="https://www.reddit.com/r/OpenClawDirectory/" class="header-link" target="_blank" rel="noopener" aria-label="Community">
          <svg viewBox="0 0 16 16" fill="currentColor" width="28" height="28"><path d="M6.167 8a.83.83 0 0 0-.83.83c0 .459.372.84.83.831a.831.831 0 0 0 0-1.661m1.843 3.647c.315 0 1.403-.038 1.976-.611a.23.23 0 0 0 0-.306.213.213 0 0 0-.306 0c-.353.363-1.126.487-1.67.487-.545 0-1.308-.124-1.671-.487a.213.213 0 0 0-.306 0 .213.213 0 0 0 0 .306c.564.563 1.652.61 1.977.61zm.992-2.807c0 .458.373.83.831.83s.83-.381.83-.83a.831.831 0 0 0-1.66 0z"/><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.828-1.165c-.315 0-.602.124-.812.325-.801-.573-1.9-.945-3.121-.993l.534-2.501 1.738.372a.83.83 0 1 0 .83-.869.83.83 0 0 0-.744.468l-1.938-.41a.2.2 0 0 0-.153.028.2.2 0 0 0-.086.134l-.592 2.788c-1.24.038-2.358.41-3.17.992-.21-.2-.496-.324-.81-.324a1.163 1.163 0 0 0-.478 2.224q-.03.17-.029.353c0 1.795 2.091 3.256 4.669 3.256s4.668-1.451 4.668-3.256c0-.114-.01-.238-.029-.353.401-.181.688-.592.688-1.069 0-.65-.525-1.165-1.165-1.165"/></svg>
        </a>
      </nav>
    </div>
  </header>
  
          <section class="skill-page-header">
            <div class="skill-page-header-inner">
              <a href="/ai-llms/" class="back-link">‚Üê Back to AI & LLMs</a>
              <div class="skill-page-meta">
                <a href="/ai-llms/" class="skill-page-category">AI & LLMs</a>
                <span class="skill-page-author">by @leegitw</span>
              </div>
              <h1 class="skill-page-title">patent-scanner</h1>
              <p class="skill-page-desc">Describe your concept and discover what makes it distinctive</p>
              <div class="vote-widget skill-page-vote" data-category-id="ai-llms" data-tool-id="patent-scanner">
                <button type="button" class="vote-btn" data-vote="1" aria-label="Upvote patent-scanner">‚ñ≤</button>
                <span class="vote-count">New</span>
                <button type="button" class="vote-btn" data-vote="-1" aria-label="Downvote patent-scanner">‚ñº</button>
              </div>
            </div>
          </section>
          <div class="skill-page-body">
            <article class="skill-page-content">
              <div class="skill-source-wrapper">
                <div class="skill-source-header">
                  <div class="skill-source-title">Source Code</div>
                  <button class="copy-btn" onclick="copySkillContent(this)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Copy
                  </button>
                </div>
                <div class="markdown-content">
                  <h1>Patent Scanner</h1>
<h2>Agent Identity</h2>
<p><strong>Role</strong>: Help users discover what makes their concepts distinctive
<strong>Approach</strong>: Provide structured analysis with clear scoring and evidence
<strong>Boundaries</strong>: Illuminate patterns, never make legal determinations
<strong>Tone</strong>: Precise, encouraging, honest about uncertainty
<strong>Safety</strong>: This skill operates locally by default. It does not transmit concept descriptions or analysis results. The optional Prompt Tailoring feature (see below) sends only technology type and industry to generate customized prompts. This skill does not modify, delete, or write any files.</p>
<h2>When to Use</h2>
<p>Activate this skill when the user asks to:</p>
<ul>
<li>&quot;Analyze my concept&quot;</li>
<li>&quot;What&#39;s distinctive about this?&quot;</li>
<li>&quot;Break down my concept into components&quot;</li>
<li>&quot;Find the sophisticated aspects&quot;</li>
<li>&quot;Score my concept&quot;</li>
</ul>
<h2>Important Limitations</h2>
<ul>
<li>This is TECHNICAL analysis, not legal advice</li>
<li>Output identifies &quot;potentially distinctive aspects&quot; not &quot;patentable inventions&quot;</li>
<li>Cannot search existing implementations (use patent-validator for that)</li>
<li>Always recommend professional consultation for IP decisions</li>
</ul>
<hr>
<h2>Prompt Tailoring (Optional)</h2>
<p>For domain-specific analysis, generate a tailored prompt instead of using the default.</p>
<p><strong>When to use</strong>: Your code uses specific technologies (React hooks, gRPC, GraphQL) that benefit from focused analysis.</p>
<p><strong>How to use</strong>:</p>
<pre><code class="language-bash">curl -X POST https://api.obviouslynot.ai/api/tailor/content \
  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{&quot;code_type&quot;: &quot;React with custom hooks&quot;, &quot;industry&quot;: &quot;fintech&quot;}&#39;
</code></pre>
<p><strong>Privacy note</strong>: This sends only your technology type and industry to the Obviously Not API to generate a tailored prompt. No concept descriptions, code, or analysis results are transmitted.</p>
<p><strong>Stealth-mode warning</strong>: For companies in stealth mode, even the combination of technology type and industry may reveal strategic direction. Consider whether this metadata is sensitive before using the tailoring feature.</p>
<p><strong>Note</strong>: The tailoring API uses a model backend to generate prompts. The <code>disable-model-invocation</code> setting prevents this skill from making direct LLM calls, but the optional tailoring feature does use AI processing on our servers.</p>
<p><strong>Response</strong>: A customized analysis prompt optimized for your technology stack.</p>
<p><strong>Then</strong>: Use the generated prompt in your next patent-scanner run for more relevant pattern detection.</p>
<hr>
<h2>Input Requirements</h2>
<p>User provides:</p>
<ul>
<li>Natural language description of your concept</li>
<li>Problem being solved</li>
<li>How it works (technical detail)</li>
<li>What makes it different</li>
<li>(Optional) Target industry/field</li>
</ul>
<hr>
<h2>Analysis Framework</h2>
<h3>Scoring Dimensions</h3>
<table>
<thead>
<tr>
<th>Dimension</th>
<th>Range</th>
<th>What It Measures</th>
</tr>
</thead>
<tbody><tr>
<td>Distinctiveness</td>
<td>0-4</td>
<td>How unique is this combination?</td>
</tr>
<tr>
<td>Sophistication</td>
<td>0-3</td>
<td>Technical complexity of the approach</td>
</tr>
<tr>
<td>System Impact</td>
<td>0-3</td>
<td>Scope of the technical contribution</td>
</tr>
<tr>
<td>Frame Shift</td>
<td>0-3</td>
<td>Does this redefine how to think about the problem?</td>
</tr>
</tbody></table>
<p><strong>Total Score</strong>: Sum of all dimensions (0-13)
<strong>Threshold</strong>: Patterns scoring &gt;=8 warrant deeper investigation</p>
<h3>1. Component Breakdown</h3>
<p>For the described concept, identify:</p>
<ul>
<li>All technologies/methods being combined</li>
<li>Source domain for each component</li>
<li>Standard vs. custom implementation</li>
<li>What each component contributes</li>
</ul>
<h3>2. Combination Analysis</h3>
<p>Analyze the combination:</p>
<ul>
<li>What emerges from the combination?</li>
<li>Unexpected synergies (1+1=3)</li>
<li>Why haven&#39;t others combined these?</li>
<li>Technical barriers overcome</li>
</ul>
<h3>3. Problem-Solution Mapping</h3>
<p>Map problem to solution:</p>
<ul>
<li>Technical problem addressed</li>
<li>How combination solves it</li>
<li>Quantifiable benefits (if known)</li>
<li>Comparison to existing approaches</li>
</ul>
<h3>4. Sophistication Assessment</h3>
<p>Evaluate sophistication:</p>
<ul>
<li>Why this combination shows technical sophistication</li>
<li>Barriers that existed before</li>
<li>Challenges in existing implementations</li>
<li>What makes this approach different</li>
</ul>
<hr>
<h2>Scoring Guide</h2>
<p><strong>Distinctiveness (0-4)</strong>:</p>
<ul>
<li>0: Standard approach, widely used</li>
<li>1: Common pattern with minor variation</li>
<li>2: Meaningful customization of known approach</li>
<li>3: Distinctive combination or significant innovation</li>
<li>4: Genuinely unique approach</li>
</ul>
<p><strong>Sophistication (0-3)</strong>:</p>
<ul>
<li>0: Straightforward implementation</li>
<li>1: Some clever optimizations</li>
<li>2: Complex but well-structured</li>
<li>3: Highly elegant solution to hard problem</li>
</ul>
<p><strong>System Impact (0-3)</strong>:</p>
<ul>
<li>0: Isolated utility</li>
<li>1: Affects one subsystem</li>
<li>2: Cross-cutting concern</li>
<li>3: Foundational to system architecture</li>
</ul>
<p><strong>Frame Shift (0-3)</strong>:</p>
<ul>
<li>0: Works within existing paradigm</li>
<li>1: Questions one assumption</li>
<li>2: Challenges core approach</li>
<li>3: Redefines the problem entirely</li>
</ul>
<hr>
<h2>Output Schema</h2>
<pre><code class="language-json">{
  &quot;scan_metadata&quot;: {
    &quot;scan_date&quot;: &quot;2026-02-03T10:00:00Z&quot;,
    &quot;input_type&quot;: &quot;description&quot;,
    &quot;industry&quot;: &quot;optional-field&quot;
  },
  &quot;patterns&quot;: [
    {
      &quot;id&quot;: &quot;pattern-1&quot;,
      &quot;title&quot;: &quot;Descriptive Pattern Title&quot;,
      &quot;category&quot;: &quot;process|hardware|software|method&quot;,
      &quot;components&quot;: [
        {&quot;name&quot;: &quot;Component A&quot;, &quot;domain&quot;: &quot;source field&quot;, &quot;role&quot;: &quot;what it does&quot;}
      ],
      &quot;scores&quot;: {
        &quot;distinctiveness&quot;: 3,
        &quot;sophistication&quot;: 2,
        &quot;system_impact&quot;: 2,
        &quot;frame_shift&quot;: 1,
        &quot;total&quot;: 8
      },
      &quot;synergy&quot;: {
        &quot;combined_benefit&quot;: &quot;What emerges from combination&quot;,
        &quot;individual_sum&quot;: &quot;What components do alone&quot;,
        &quot;synergy_factor&quot;: &quot;What&#39;s greater than sum of parts&quot;
      },
      &quot;evidence&quot;: {
        &quot;user_claims&quot;: [&quot;Stated differentiators&quot;],
        &quot;technical_details&quot;: [&quot;Specific mechanisms described&quot;]
      }
    }
  ],
  &quot;summary&quot;: {
    &quot;total_patterns&quot;: 3,
    &quot;high_value_patterns&quot;: 2,
    &quot;recommended_focus&quot;: &quot;pattern-1&quot;
  }
}
</code></pre>
<hr>
<h2>Output Format</h2>
<h3>Analysis Report</h3>
<pre><code class="language-markdown"># Concept Analysis: [Title]

**Scanned**: [date] | **Patterns Found**: [N]

---

## Component Breakdown

| Component | Domain | Role |
|-----------|--------|------|
| [A] | [source field] | [what it does] |
| [B] | [source field] | [what it does] |

---

## Distinctive Patterns

### 1. [Pattern Title] (Score: X/13)

**Category**: [category]

**Components Combined**:
- [Component A] from [domain]
- [Component B] from [domain]

**Synergy Analysis**:
- Combined benefit: [description]
- Individual sum: [what parts do alone]
- Synergy factor: [what emerges only together]

**Why Distinctive**: [explanation]

---

## Summary

| Pattern | Score | Category |
|---------|-------|----------|
| [Pattern 1] | X/13 | [category] |

---
</code></pre>
<hr>
<h2>Share Card Format</h2>
<p><strong>Standard Format</strong> (use by default):</p>
<pre><code class="language-markdown">## [Concept Title] - Patent Scanner Results

**[N] Distinctive Patterns Found**

| Pattern | Score |
|---------|-------|
| [Pattern 1 Title] | X/13 |
| [Pattern 2 Title] | X/13 |

*Analyzed with [patent-scanner](https://obviouslynot.ai) from obviouslynot.ai*
</code></pre>
<h3>High-Value Pattern Detected</h3>
<p>For patterns scoring 8+/13, include:</p>
<blockquote>
<p><strong>Strong distinctive signal!</strong> Consider sharing your discovery:
&quot;Found a distinctive pattern (X/13) using obviouslynot.ai patent tools üî¨&quot;</p>
</blockquote>
<hr>
<h2>Next Steps (Required in All Outputs)</h2>
<pre><code class="language-markdown">## Next Steps

1. **Review** - Prioritize patterns scoring &gt;=8
2. **Tailor** (Optional) - For domain-specific tech (React, gRPC, etc.), see &quot;Prompt Tailoring&quot; section above
3. **Validate** - Run `patent-validator` for search strategies
4. **Document** - Capture technical details, sketches, prototypes
5. **Consult** - For high-value patterns, consult patent attorney

*Rescan monthly as concept evolves. IP Timing: Public disclosure starts 12-month US filing clock.*
</code></pre>
<hr>
<h2>Terminology Rules (MANDATORY)</h2>
<h3>Never Use</h3>
<ul>
<li>&quot;patentable&quot;</li>
<li>&quot;novel&quot; (legal sense)</li>
<li>&quot;non-obvious&quot;</li>
<li>&quot;prior art&quot;</li>
<li>&quot;claims&quot;</li>
<li>&quot;file immediately&quot;</li>
</ul>
<h3>Always Use Instead</h3>
<ul>
<li>&quot;distinctive&quot;</li>
<li>&quot;unique&quot;</li>
<li>&quot;sophisticated&quot;</li>
<li>&quot;existing implementations&quot;</li>
<li>&quot;consider consulting attorney&quot;</li>
</ul>
<hr>
<h2>Sensitive Data Warning</h2>
<ul>
<li>Analysis outputs may be stored in your chat history or logs</li>
<li>Avoid analyzing proprietary information if outputs might be shared</li>
<li>For patent-related work, premature public disclosure can affect filing rights</li>
<li>Review outputs before sharing to ensure no confidential information is exposed</li>
</ul>
<hr>
<h2>Required Disclaimer</h2>
<p>ALWAYS include at the end of ANY output:</p>
<blockquote>
<p><strong>Disclaimer</strong>: This analysis identifies distinctive technical aspects based on the recombination framework. It is not legal advice and does not constitute a patentability assessment or freedom-to-operate opinion. Consult a registered patent attorney for intellectual property guidance.</p>
</blockquote>
<hr>
<h2>Error Handling</h2>
<p><strong>Insufficient Description</strong>:</p>
<pre><code>I need more detail to generate useful analysis. What&#39;s the technical mechanism? What problem does it solve? What makes it different?
</code></pre>
<p><strong>No Distinctive Aspects Found</strong>:</p>
<pre><code>No patterns scored above threshold (5/13). This may mean the distinctiveness is in execution, not architecture. Try adding more specific technical details about HOW it works.
</code></pre>
<hr>
<h2>Related Skills</h2>
<ul>
<li><strong>patent-validator</strong>: Generate search strategies for scanner findings</li>
<li><strong>code-patent-scanner</strong>: Analyze source code (for software concepts)</li>
<li><strong>code-patent-validator</strong>: Validate code pattern distinctiveness</li>
<li><strong>Tailoring API</strong>: Generate domain-specific prompts (see &quot;Prompt Tailoring&quot; section)</li>
</ul>
<hr>
<p><em>Built by Obviously Not - Tools for thought, not conclusions.</em></p>

                </div>
              </div>
            </article>
            <aside class="skill-page-sidebar">
              <div class="sidebar-card">
                <div class="sidebar-title">Actions</div>
                <a href="https://github.com/openclaw/skills/tree/main/skills/leegitw/patent-scanner/SKILL.md" target="_blank" rel="noopener" class="sidebar-btn sidebar-btn-primary">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
                  View on GitHub
                </a>
                <a href="https://clawdhub.com/leegitw/patent-scanner" target="_blank" rel="noopener" class="sidebar-btn sidebar-btn-clawdhub">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><line x1="2" y1="12" x2="22" y2="12"/></svg>
                  View on ClawdHub
                </a>
                <a href="https://raw.githubusercontent.com/openclaw/skills/main/skills/leegitw/patent-scanner/SKILL.md" download="SKILL.md" class="sidebar-btn sidebar-btn-secondary">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  Download SKILL.md
                </a>
                <button onclick="sendToSecurityAuditor()" class="sidebar-btn sidebar-btn-security">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                  Security Check
                </button>
              </div>
              <div class="sidebar-card">
                <div class="sidebar-title">Details</div>
                <div class="sidebar-info">
                  <div class="sidebar-info-item">
                    <span class="sidebar-info-label">Author</span>
                    <span class="sidebar-info-value">@leegitw</span>
                  </div>
                  <div class="sidebar-info-item">
                    <span class="sidebar-info-label">Category</span>
                    <span class="sidebar-info-value">AI & LLMs</span>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        
  <footer class="footer">
    <div class="footer-inner">
      <p class="footer-text" style="margin-bottom: 8px;"><a href="https://github.com/neonone123/moltdirectory" target="_blank" rel="noopener" style="color: var(--accent); text-decoration: none;">View on GitHub</a></p>
      <p class="footer-text" style="opacity: 0.6; font-size: 13px;">OpenClawDirectory.com is a community-run project and is not affiliated with the official OpenClaw team or Peter Steinberger. We are just fans of the lobster.</p>
    </div>
  </footer>
  <script>
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      if (newTheme === 'light') {
        html.setAttribute('data-theme', 'light');
      } else {
        html.removeAttribute('data-theme');
      }
      localStorage.setItem('theme', newTheme);
    }
    
    function copySkillContent(btn) {
      const wrapper = btn.closest('.skill-source-wrapper');
      const content = wrapper.querySelector('.markdown-content');
      if (content) {
        const text = content.innerText || content.textContent;
        navigator.clipboard.writeText(text).then(() => {
          btn.classList.add('copied');
          btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Copied!';
          setTimeout(() => {
            btn.classList.remove('copied');
            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copy';
          }, 2000);
        });
      }
    }

    async function sendToSecurityAuditor() {
      try {
        const contentElement = document.querySelector('.markdown-content');
        if (!contentElement) throw new Error('Could not find markdown content');
        const skillContent = contentElement.innerText || contentElement.textContent;
        localStorage.setItem('skillAuditContent', skillContent);
        window.open('/security-auditor', '_blank'); 
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function updateVoteWidget(widget, toolData) {
      if (!widget || !toolData) return;
      const upBtn = widget.querySelector('[data-vote="1"]');
      const downBtn = widget.querySelector('[data-vote="-1"]');
      const countNode = widget.querySelector('.vote-count');
      widget.dataset.rankScore = String(toolData.rankScore ?? 0);
      widget.dataset.viewerVote = String(toolData.viewerVote ?? 0);

      if (countNode) {
        countNode.textContent = toolData.displayCount || 'New';
      }
      if (upBtn) {
        upBtn.classList.toggle('is-active', Number(toolData.viewerVote) === 1);
      }
      if (downBtn) {
        downBtn.classList.toggle('is-active', Number(toolData.viewerVote) === -1);
      }
    }

    function setWidgetBusy(widget, busy) {
      widget.dataset.busy = busy ? '1' : '0';
      widget.querySelectorAll('.vote-btn').forEach((btn) => {
        btn.disabled = busy;
      });
    }

    function applySortMode(grid, mode) {
      const cards = [...grid.querySelectorAll('.skill-card[data-tool-id]')];
      cards.sort((a, b) => {
        if (mode === 'community') {
          const scoreDiff = Number(b.dataset.rankScore || 0) - Number(a.dataset.rankScore || 0);
          if (scoreDiff !== 0) return scoreDiff;
        }
        return Number(a.dataset.originalIndex || 0) - Number(b.dataset.originalIndex || 0);
      });
      cards.forEach((card) => grid.appendChild(card));
    }

    function bindSortToggle(toolbar, grid) {
      const buttons = toolbar.querySelectorAll('.sort-toggle-btn');
      const status = toolbar.querySelector('.sort-status');
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const mode = btn.dataset.sortMode;
          buttons.forEach((b) => b.classList.toggle('is-active', b === btn));
          applySortMode(grid, mode);
          status.textContent = mode === 'community' ? 'Community ranking active' : 'Original order active';
        });
      });
    }

    async function fetchScores(categoryId, toolIds) {
      const params = new URLSearchParams({
        categoryId,
        toolIds: toolIds.join(',')
      });
      const response = await fetch('/api/v1/scores?' + params.toString(), {
        method: 'GET',
        credentials: 'same-origin'
      });
      if (!response.ok) {
        throw new Error('Unable to fetch vote scores');
      }
      return response.json();
    }

    async function submitVote(widget, voteValue) {
      const categoryId = widget.dataset.categoryId;
      const toolId = widget.dataset.toolId;
      setWidgetBusy(widget, true);
      try {
        const response = await fetch('/api/v1/vote', {
          method: 'POST',
          credentials: 'same-origin',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            categoryId,
            toolId,
            vote: voteValue
          })
        });
        const payload = await response.json().catch(() => ({}));
        if (!response.ok) {
          throw new Error(payload.error || 'Vote request failed');
        }
        if (payload.tool) {
          updateVoteWidget(widget, payload.tool);
          const card = widget.closest('.skill-card[data-tool-id]');
          if (card) {
            card.dataset.rankScore = String(payload.tool.rankScore ?? 0);
          }
        }
      } catch (error) {
        console.error(error);
      } finally {
        setWidgetBusy(widget, false);
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const widgets = [...document.querySelectorAll('.vote-widget[data-category-id][data-tool-id]')];
      if (widgets.length === 0) return;

      const grouped = new Map();
      widgets.forEach((widget) => {
        const key = widget.dataset.categoryId;
        if (!grouped.has(key)) grouped.set(key, new Map());
        grouped.get(key).set(widget.dataset.toolId, widget);
      });

      for (const [categoryId, widgetMap] of grouped.entries()) {
        const toolIds = [...widgetMap.keys()];
        try {
          const data = await fetchScores(categoryId, toolIds);
          const byTool = new Map((data.tools || []).map((tool) => [tool.toolId, tool]));
          for (const [toolId, widget] of widgetMap.entries()) {
            const toolData = byTool.get(toolId);
            if (toolData) {
              updateVoteWidget(widget, toolData);
              const card = widget.closest('.skill-card[data-tool-id]');
              if (card) {
                card.dataset.rankScore = String(toolData.rankScore ?? 0);
              }
            }
          }
        } catch (error) {
          console.error(error);
        }
      }

      widgets.forEach((widget) => {
        widget.querySelectorAll('.vote-btn').forEach((btn) => {
          btn.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            if (widget.dataset.busy === '1') return;
            const voteValue = Number(btn.dataset.vote);
            submitVote(widget, voteValue).then(() => {
              const grid = widget.closest('.skills-grid[data-category-id]');
              const toolbar = document.querySelector('.sort-toolbar[data-category-id="' + widget.dataset.categoryId + '"]');
              const communityBtn = toolbar ? toolbar.querySelector('.sort-toggle-btn[data-sort-mode="community"]') : null;
              if (grid && communityBtn && communityBtn.classList.contains('is-active')) {
                applySortMode(grid, 'community');
              }
            });
          });
        });
      });

      document.querySelectorAll('.skills-grid[data-category-id]').forEach((grid) => {
        const categoryId = grid.dataset.categoryId;
        const toolbar = document.querySelector('.sort-toolbar[data-category-id="' + categoryId + '"]');
        if (!toolbar) return;
        bindSortToggle(toolbar, grid);
        applySortMode(grid, 'community');
      });
    });
  </script>
</body>
</html>