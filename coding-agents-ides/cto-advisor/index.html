<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Technical leadership guidance for engineering teams">
  <title>cto-advisor - OpenClaw Directory</title>
  <link rel="canonical" href="https://moltdirectory.com/coding-agents-ides/cto-advisor/">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶û</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    // Apply saved theme before page renders to prevent flash
    (function() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      if (savedTheme === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo">

        <span class="logo-text">OpenClaw Directory</span>
      </a>
      <nav class="header-links">
        <a href="/start-here/" class="header-link">Start Here</a>
        <a href="/security-auditor" class="header-link">Security Auditor</a>
        <a href="https://github.com/neonone123/moltdirectory/issues/new?template=add-skill.yml" class="header-link" target="_blank" rel="noopener">Add Skill</a>
        <button class="theme-toggle" aria-label="Toggle theme" onclick="toggleTheme()">
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
        <a href="https://www.reddit.com/r/OpenClawDirectory/" class="header-link" target="_blank" rel="noopener" aria-label="Community">
          <svg viewBox="0 0 16 16" fill="currentColor" width="28" height="28"><path d="M6.167 8a.83.83 0 0 0-.83.83c0 .459.372.84.83.831a.831.831 0 0 0 0-1.661m1.843 3.647c.315 0 1.403-.038 1.976-.611a.23.23 0 0 0 0-.306.213.213 0 0 0-.306 0c-.353.363-1.126.487-1.67.487-.545 0-1.308-.124-1.671-.487a.213.213 0 0 0-.306 0 .213.213 0 0 0 0 .306c.564.563 1.652.61 1.977.61zm.992-2.807c0 .458.373.83.831.83s.83-.381.83-.83a.831.831 0 0 0-1.66 0z"/><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.828-1.165c-.315 0-.602.124-.812.325-.801-.573-1.9-.945-3.121-.993l.534-2.501 1.738.372a.83.83 0 1 0 .83-.869.83.83 0 0 0-.744.468l-1.938-.41a.2.2 0 0 0-.153.028.2.2 0 0 0-.086.134l-.592 2.788c-1.24.038-2.358.41-3.17.992-.21-.2-.496-.324-.81-.324a1.163 1.163 0 0 0-.478 2.224q-.03.17-.029.353c0 1.795 2.091 3.256 4.669 3.256s4.668-1.451 4.668-3.256c0-.114-.01-.238-.029-.353.401-.181.688-.592.688-1.069 0-.65-.525-1.165-1.165-1.165"/></svg>
        </a>
      </nav>
    </div>
  </header>
  
          <section class="skill-page-header">
            <div class="skill-page-header-inner">
              <a href="/coding-agents-ides/" class="back-link">‚Üê Back to Coding Agents & IDEs</a>
              <div class="skill-page-meta">
                <a href="/coding-agents-ides/" class="skill-page-category">Coding Agents & IDEs</a>
                <span class="skill-page-author">by @alirezarezvani</span>
              </div>
              <h1 class="skill-page-title">cto-advisor</h1>
              <p class="skill-page-desc">Technical leadership guidance for engineering teams</p>
              <div class="vote-widget skill-page-vote" data-category-id="coding-agents-ides" data-tool-id="cto-advisor">
                <button type="button" class="vote-btn" data-vote="1" aria-label="Upvote cto-advisor">‚ñ≤</button>
                <span class="vote-count">New</span>
                <button type="button" class="vote-btn" data-vote="-1" aria-label="Downvote cto-advisor">‚ñº</button>
              </div>
            </div>
          </section>
          <div class="skill-page-body">
            <article class="skill-page-content">
              <div class="skill-source-wrapper">
                <div class="skill-source-header">
                  <div class="skill-source-title">Source Code</div>
                  <button class="copy-btn" onclick="copySkillContent(this)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Copy
                  </button>
                </div>
                <div class="markdown-content">
                  <h1>CTO Advisor</h1>
<p>Strategic frameworks and tools for technology leadership, team scaling, and engineering excellence.</p>
<h2>Keywords</h2>
<p>CTO, chief technology officer, technical leadership, tech debt, technical debt, engineering team, team scaling, architecture decisions, technology evaluation, engineering metrics, DORA metrics, ADR, architecture decision records, technology strategy, engineering leadership, engineering organization, team structure, hiring plan, technical strategy, vendor evaluation, technology selection</p>
<h2>Quick Start</h2>
<h3>For Technical Debt Assessment</h3>
<pre><code class="language-bash">python scripts/tech_debt_analyzer.py
</code></pre>
<p>Analyzes system architecture and provides prioritized debt reduction plan.</p>
<h3>For Team Scaling Planning</h3>
<pre><code class="language-bash">python scripts/team_scaling_calculator.py
</code></pre>
<p>Calculates optimal hiring plan and team structure for growth.</p>
<h3>For Architecture Decisions</h3>
<p>Review <code>references/architecture_decision_records.md</code> for ADR templates and examples.</p>
<h3>For Technology Evaluation</h3>
<p>Use framework in <code>references/technology_evaluation_framework.md</code> for vendor selection.</p>
<h3>For Engineering Metrics</h3>
<p>Implement KPIs from <code>references/engineering_metrics.md</code> for team performance tracking.</p>
<h2>Core Responsibilities</h2>
<h3>1. Technology Strategy</h3>
<h4>Vision &amp; Roadmap</h4>
<ul>
<li>Define 3-5 year technology vision</li>
<li>Create quarterly roadmaps</li>
<li>Align with business strategy</li>
<li>Communicate to stakeholders</li>
</ul>
<h4>Innovation Management</h4>
<ul>
<li>Allocate 20% time for innovation</li>
<li>Run hackathons quarterly</li>
<li>Evaluate emerging technologies</li>
<li>Build proof of concepts</li>
</ul>
<h4>Technical Debt Strategy</h4>
<pre><code class="language-bash"># Assess current debt
python scripts/tech_debt_analyzer.py

# Allocate capacity
- Critical debt: 40% capacity
- High debt: 25% capacity  
- Medium debt: 15% capacity
- Low debt: Ongoing maintenance
</code></pre>
<h3>2. Team Leadership</h3>
<h4>Scaling Engineering</h4>
<pre><code class="language-bash"># Calculate scaling needs
python scripts/team_scaling_calculator.py

# Key ratios to maintain:
- Manager:Engineer = 1:8
- Senior:Mid:Junior = 3:4:2
- Product:Engineering = 1:10
- QA:Engineering = 1.5:10
</code></pre>
<h4>Performance Management</h4>
<ul>
<li>Set clear OKRs quarterly</li>
<li>Conduct 1:1s weekly</li>
<li>Review performance quarterly</li>
<li>Provide growth opportunities</li>
</ul>
<h4>Culture Building</h4>
<ul>
<li>Define engineering values</li>
<li>Establish coding standards</li>
<li>Create learning programs</li>
<li>Foster collaboration</li>
</ul>
<h3>3. Architecture Governance</h3>
<h4>Decision Making</h4>
<p>Use ADR template from <code>references/architecture_decision_records.md</code>:</p>
<ol>
<li>Document context and problem</li>
<li>List all options considered</li>
<li>Record decision and rationale</li>
<li>Track consequences</li>
</ol>
<h4>Technology Standards</h4>
<ul>
<li>Language choices</li>
<li>Framework selection</li>
<li>Database standards</li>
<li>Security requirements</li>
<li>API design guidelines</li>
</ul>
<h4>System Design Review</h4>
<ul>
<li>Weekly architecture reviews</li>
<li>Design documentation standards</li>
<li>Prototype requirements</li>
<li>Performance criteria</li>
</ul>
<h3>4. Vendor Management</h3>
<h4>Evaluation Process</h4>
<p>Follow framework in <code>references/technology_evaluation_framework.md</code>:</p>
<ol>
<li>Gather requirements (Week 1)</li>
<li>Market research (Week 1-2)</li>
<li>Deep evaluation (Week 2-4)</li>
<li>Decision and documentation (Week 4)</li>
</ol>
<h4>Vendor Relationships</h4>
<ul>
<li>Quarterly business reviews</li>
<li>SLA monitoring</li>
<li>Cost optimization</li>
<li>Strategic partnerships</li>
</ul>
<h3>5. Engineering Excellence</h3>
<h4>Metrics Implementation</h4>
<p>From <code>references/engineering_metrics.md</code>:</p>
<p><strong>DORA Metrics</strong> (Deploy to production targets):</p>
<ul>
<li>Deployment Frequency: &gt;1/day</li>
<li>Lead Time: &lt;1 day</li>
<li>MTTR: &lt;1 hour</li>
<li>Change Failure Rate: &lt;15%</li>
</ul>
<p><strong>Quality Metrics</strong>:</p>
<ul>
<li>Test Coverage: &gt;80%</li>
<li>Code Review: 100%</li>
<li>Technical Debt: &lt;10%</li>
</ul>
<p><strong>Team Health</strong>:</p>
<ul>
<li>Sprint Velocity: ¬±10% variance</li>
<li>Unplanned Work: &lt;20%</li>
<li>On-call Incidents: &lt;5/week</li>
</ul>
<h2>Weekly Cadence</h2>
<h3>Monday</h3>
<ul>
<li>Leadership team sync</li>
<li>Review metrics dashboard</li>
<li>Address escalations</li>
</ul>
<h3>Tuesday</h3>
<ul>
<li>Architecture review</li>
<li>Technical interviews</li>
<li>1:1s with directs</li>
</ul>
<h3>Wednesday</h3>
<ul>
<li>Cross-functional meetings</li>
<li>Vendor meetings</li>
<li>Strategy work</li>
</ul>
<h3>Thursday</h3>
<ul>
<li>Team all-hands (monthly)</li>
<li>Sprint reviews (bi-weekly)</li>
<li>Technical deep dives</li>
</ul>
<h3>Friday</h3>
<ul>
<li>Strategic planning</li>
<li>Innovation time</li>
<li>Week recap and planning</li>
</ul>
<h2>Quarterly Planning</h2>
<h3>Q1 Focus: Foundation</h3>
<ul>
<li>Annual planning</li>
<li>Budget allocation</li>
<li>Team goal setting</li>
<li>Technology assessment</li>
</ul>
<h3>Q2 Focus: Execution</h3>
<ul>
<li>Major initiatives launch</li>
<li>Mid-year hiring push</li>
<li>Performance reviews</li>
<li>Architecture evolution</li>
</ul>
<h3>Q3 Focus: Innovation</h3>
<ul>
<li>Hackathon</li>
<li>Technology exploration</li>
<li>Team development</li>
<li>Process optimization</li>
</ul>
<h3>Q4 Focus: Planning</h3>
<ul>
<li>Next year strategy</li>
<li>Budget planning</li>
<li>Promotion cycles</li>
<li>Debt reduction sprint</li>
</ul>
<h2>Crisis Management</h2>
<h3>Incident Response</h3>
<ol>
<li><p><strong>Immediate</strong> (0-15 min):</p>
<ul>
<li>Assess severity</li>
<li>Activate incident team</li>
<li>Begin communication</li>
</ul>
</li>
<li><p><strong>Short-term</strong> (15-60 min):</p>
<ul>
<li>Implement fixes</li>
<li>Update stakeholders</li>
<li>Monitor systems</li>
</ul>
</li>
<li><p><strong>Resolution</strong> (1-24 hours):</p>
<ul>
<li>Verify fix</li>
<li>Document timeline</li>
<li>Customer communication</li>
</ul>
</li>
<li><p><strong>Post-mortem</strong> (48-72 hours):</p>
<ul>
<li>Root cause analysis</li>
<li>Action items</li>
<li>Process improvements</li>
</ul>
</li>
</ol>
<h3>Types of Crises</h3>
<h4>Security Breach</h4>
<ul>
<li>Isolate affected systems</li>
<li>Engage security team</li>
<li>Legal/compliance notification</li>
<li>Customer communication plan</li>
</ul>
<h4>Major Outage</h4>
<ul>
<li>All-hands response</li>
<li>Status page updates</li>
<li>Executive briefings</li>
<li>Customer outreach</li>
</ul>
<h4>Data Loss</h4>
<ul>
<li>Stop writes immediately</li>
<li>Assess recovery options</li>
<li>Begin restoration</li>
<li>Impact analysis</li>
</ul>
<h2>Stakeholder Management</h2>
<h3>Board/Executive Reporting</h3>
<p><strong>Monthly</strong>:</p>
<ul>
<li>KPI dashboard</li>
<li>Risk register</li>
<li>Major initiatives status</li>
</ul>
<p><strong>Quarterly</strong>:</p>
<ul>
<li>Technology strategy update</li>
<li>Team growth and health</li>
<li>Innovation highlights</li>
<li>Budget review</li>
</ul>
<h3>Cross-functional Partners</h3>
<h4>Product Team</h4>
<ul>
<li>Weekly roadmap sync</li>
<li>Sprint planning participation</li>
<li>Technical feasibility reviews</li>
<li>Feature estimation</li>
</ul>
<h4>Sales/Marketing</h4>
<ul>
<li>Technical sales support</li>
<li>Product capability briefings</li>
<li>Customer reference calls</li>
<li>Competitive analysis</li>
</ul>
<h4>Finance</h4>
<ul>
<li>Budget management</li>
<li>Cost optimization</li>
<li>Vendor negotiations</li>
<li>Capex planning</li>
</ul>
<h2>Strategic Initiatives</h2>
<h3>Digital Transformation</h3>
<ol>
<li>Assess current state</li>
<li>Define target architecture</li>
<li>Create migration plan</li>
<li>Execute in phases</li>
<li>Measure and adjust</li>
</ol>
<h3>Cloud Migration</h3>
<ol>
<li>Application assessment</li>
<li>Migration strategy (7Rs)</li>
<li>Pilot applications</li>
<li>Full migration</li>
<li>Optimization</li>
</ol>
<h3>Platform Engineering</h3>
<ol>
<li>Define platform vision</li>
<li>Build core services</li>
<li>Create self-service tools</li>
<li>Enable team adoption</li>
<li>Measure efficiency</li>
</ol>
<h3>AI/ML Integration</h3>
<ol>
<li>Identify use cases</li>
<li>Build data infrastructure</li>
<li>Develop models</li>
<li>Deploy and monitor</li>
<li>Scale adoption</li>
</ol>
<h2>Communication Templates</h2>
<h3>Technology Strategy Presentation</h3>
<pre><code>1. Executive Summary (1 slide)
2. Current State Assessment (2 slides)
3. Vision &amp; Strategy (2 slides)
4. Roadmap &amp; Milestones (3 slides)
5. Investment Required (1 slide)
6. Risks &amp; Mitigation (1 slide)
7. Success Metrics (1 slide)
</code></pre>
<h3>Team All-hands</h3>
<pre><code>1. Wins &amp; Recognition (5 min)
2. Metrics Review (5 min)
3. Strategic Updates (10 min)
4. Demo/Deep Dive (15 min)
5. Q&amp;A (10 min)
</code></pre>
<h3>Board Update Email</h3>
<pre><code>Subject: Engineering Update - [Month]

Highlights:
‚Ä¢ [Major achievement]
‚Ä¢ [Key metric improvement]
‚Ä¢ [Strategic progress]

Challenges:
‚Ä¢ [Issue and mitigation]

Next Month:
‚Ä¢ [Priority 1]
‚Ä¢ [Priority 2]

Detailed metrics attached.
</code></pre>
<h2>Tools &amp; Resources</h2>
<h3>Essential Tools</h3>
<ul>
<li><strong>Architecture</strong>: Draw.io, Lucidchart, C4 Model</li>
<li><strong>Metrics</strong>: DataDog, Grafana, LinearB</li>
<li><strong>Planning</strong>: Jira, Confluence, Notion</li>
<li><strong>Communication</strong>: Slack, Zoom, Loom</li>
<li><strong>Development</strong>: GitHub, GitLab, Bitbucket</li>
</ul>
<h3>Key Resources</h3>
<ul>
<li><p><strong>Books</strong>: </p>
<ul>
<li>&quot;The Manager&#39;s Path&quot; - Camille Fournier</li>
<li>&quot;Accelerate&quot; - Nicole Forsgren</li>
<li>&quot;Team Topologies&quot; - Skelton &amp; Pais</li>
</ul>
</li>
<li><p><strong>Frameworks</strong>:</p>
<ul>
<li>DORA metrics</li>
<li>SPACE framework</li>
<li>Team Topologies</li>
</ul>
</li>
<li><p><strong>Communities</strong>:</p>
<ul>
<li>CTO Craft</li>
<li>Engineering Leadership Slack</li>
<li>LeadDev community</li>
</ul>
</li>
</ul>
<h2>Success Indicators</h2>
<p>‚úÖ <strong>Technical Excellence</strong></p>
<ul>
<li>System uptime &gt;99.9%</li>
<li>Deploy multiple times daily</li>
<li>Technical debt &lt;10% capacity</li>
<li>Security incidents = 0</li>
</ul>
<p>‚úÖ <strong>Team Success</strong></p>
<ul>
<li>Team satisfaction &gt;8/10</li>
<li>Attrition &lt;10%</li>
<li>Filled positions &gt;90%</li>
<li>Diversity improving</li>
</ul>
<p>‚úÖ <strong>Business Impact</strong></p>
<ul>
<li>Features on-time &gt;80%</li>
<li>Engineering enables revenue</li>
<li>Cost per transaction decreasing</li>
<li>Innovation driving growth</li>
</ul>
<h2>Red Flags to Watch</h2>
<p>‚ö†Ô∏è Increasing technical debt<br>‚ö†Ô∏è Rising attrition rate<br>‚ö†Ô∏è Slowing velocity<br>‚ö†Ô∏è Growing incidents<br>‚ö†Ô∏è Team morale declining<br>‚ö†Ô∏è Budget overruns<br>‚ö†Ô∏è Vendor dependencies<br>‚ö†Ô∏è Security vulnerabilities</p>

                </div>
              </div>
            </article>
            <aside class="skill-page-sidebar">
              <div class="sidebar-card">
                <div class="sidebar-title">Actions</div>
                <a href="https://github.com/openclaw/skills/tree/main/skills/alirezarezvani/cto-advisor/SKILL.md" target="_blank" rel="noopener" class="sidebar-btn sidebar-btn-primary">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
                  View on GitHub
                </a>
                <a href="https://clawdhub.com/alirezarezvani/cto-advisor" target="_blank" rel="noopener" class="sidebar-btn sidebar-btn-clawdhub">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><line x1="2" y1="12" x2="22" y2="12"/></svg>
                  View on ClawdHub
                </a>
                <a href="https://raw.githubusercontent.com/openclaw/skills/main/skills/alirezarezvani/cto-advisor/SKILL.md" download="SKILL.md" class="sidebar-btn sidebar-btn-secondary">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  Download SKILL.md
                </a>
                <button onclick="sendToSecurityAuditor()" class="sidebar-btn sidebar-btn-security">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                  Security Check
                </button>
              </div>
              <div class="sidebar-card">
                <div class="sidebar-title">Details</div>
                <div class="sidebar-info">
                  <div class="sidebar-info-item">
                    <span class="sidebar-info-label">Author</span>
                    <span class="sidebar-info-value">@alirezarezvani</span>
                  </div>
                  <div class="sidebar-info-item">
                    <span class="sidebar-info-label">Category</span>
                    <span class="sidebar-info-value">Coding Agents & IDEs</span>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        
  <footer class="footer">
    <div class="footer-inner">
      <p class="footer-text" style="margin-bottom: 8px;"><a href="https://github.com/neonone123/moltdirectory" target="_blank" rel="noopener" style="color: var(--accent); text-decoration: none;">View on GitHub</a></p>
      <p class="footer-text" style="opacity: 0.6; font-size: 13px;">OpenClawDirectory.com is a community-run project and is not affiliated with the official OpenClaw team or Peter Steinberger. We are just fans of the lobster.</p>
    </div>
  </footer>
  <script>
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      if (newTheme === 'light') {
        html.setAttribute('data-theme', 'light');
      } else {
        html.removeAttribute('data-theme');
      }
      localStorage.setItem('theme', newTheme);
    }
    
    function copySkillContent(btn) {
      const wrapper = btn.closest('.skill-source-wrapper');
      const content = wrapper.querySelector('.markdown-content');
      if (content) {
        const text = content.innerText || content.textContent;
        navigator.clipboard.writeText(text).then(() => {
          btn.classList.add('copied');
          btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Copied!';
          setTimeout(() => {
            btn.classList.remove('copied');
            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copy';
          }, 2000);
        });
      }
    }

    async function sendToSecurityAuditor() {
      try {
        const contentElement = document.querySelector('.markdown-content');
        if (!contentElement) throw new Error('Could not find markdown content');
        const skillContent = contentElement.innerText || contentElement.textContent;
        localStorage.setItem('skillAuditContent', skillContent);
        window.open('/security-auditor', '_blank'); 
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function updateVoteWidget(widget, toolData) {
      if (!widget || !toolData) return;
      const upBtn = widget.querySelector('[data-vote="1"]');
      const downBtn = widget.querySelector('[data-vote="-1"]');
      const countNode = widget.querySelector('.vote-count');
      widget.dataset.rankScore = String(toolData.rankScore ?? 0);
      widget.dataset.viewerVote = String(toolData.viewerVote ?? 0);

      if (countNode) {
        countNode.textContent = toolData.displayCount || 'New';
      }
      if (upBtn) {
        upBtn.classList.toggle('is-active', Number(toolData.viewerVote) === 1);
      }
      if (downBtn) {
        downBtn.classList.toggle('is-active', Number(toolData.viewerVote) === -1);
      }
    }

    function setWidgetBusy(widget, busy) {
      widget.dataset.busy = busy ? '1' : '0';
      widget.querySelectorAll('.vote-btn').forEach((btn) => {
        btn.disabled = busy;
      });
    }

    function applySortMode(grid, mode) {
      const cards = [...grid.querySelectorAll('.skill-card[data-tool-id]')];
      cards.sort((a, b) => {
        if (mode === 'community') {
          const scoreDiff = Number(b.dataset.rankScore || 0) - Number(a.dataset.rankScore || 0);
          if (scoreDiff !== 0) return scoreDiff;
        }
        return Number(a.dataset.originalIndex || 0) - Number(b.dataset.originalIndex || 0);
      });
      cards.forEach((card) => grid.appendChild(card));
    }

    function bindSortToggle(toolbar, grid) {
      const buttons = toolbar.querySelectorAll('.sort-toggle-btn');
      const status = toolbar.querySelector('.sort-status');
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const mode = btn.dataset.sortMode;
          buttons.forEach((b) => b.classList.toggle('is-active', b === btn));
          applySortMode(grid, mode);
          status.textContent = mode === 'community' ? 'Community ranking active' : 'Original order active';
        });
      });
    }

    async function fetchScores(categoryId, toolIds) {
      const params = new URLSearchParams({
        categoryId,
        toolIds: toolIds.join(',')
      });
      const response = await fetch('/api/v1/scores?' + params.toString(), {
        method: 'GET',
        credentials: 'same-origin'
      });
      if (!response.ok) {
        throw new Error('Unable to fetch vote scores');
      }
      return response.json();
    }

    async function submitVote(widget, voteValue) {
      const categoryId = widget.dataset.categoryId;
      const toolId = widget.dataset.toolId;
      setWidgetBusy(widget, true);
      try {
        const response = await fetch('/api/v1/vote', {
          method: 'POST',
          credentials: 'same-origin',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            categoryId,
            toolId,
            vote: voteValue
          })
        });
        const payload = await response.json().catch(() => ({}));
        if (!response.ok) {
          throw new Error(payload.error || 'Vote request failed');
        }
        if (payload.tool) {
          updateVoteWidget(widget, payload.tool);
          const card = widget.closest('.skill-card[data-tool-id]');
          if (card) {
            card.dataset.rankScore = String(payload.tool.rankScore ?? 0);
          }
        }
      } catch (error) {
        console.error(error);
      } finally {
        setWidgetBusy(widget, false);
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const widgets = [...document.querySelectorAll('.vote-widget[data-category-id][data-tool-id]')];
      if (widgets.length === 0) return;

      const grouped = new Map();
      widgets.forEach((widget) => {
        const key = widget.dataset.categoryId;
        if (!grouped.has(key)) grouped.set(key, new Map());
        grouped.get(key).set(widget.dataset.toolId, widget);
      });

      for (const [categoryId, widgetMap] of grouped.entries()) {
        const toolIds = [...widgetMap.keys()];
        try {
          const data = await fetchScores(categoryId, toolIds);
          const byTool = new Map((data.tools || []).map((tool) => [tool.toolId, tool]));
          for (const [toolId, widget] of widgetMap.entries()) {
            const toolData = byTool.get(toolId);
            if (toolData) {
              updateVoteWidget(widget, toolData);
              const card = widget.closest('.skill-card[data-tool-id]');
              if (card) {
                card.dataset.rankScore = String(toolData.rankScore ?? 0);
              }
            }
          }
        } catch (error) {
          console.error(error);
        }
      }

      widgets.forEach((widget) => {
        widget.querySelectorAll('.vote-btn').forEach((btn) => {
          btn.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            if (widget.dataset.busy === '1') return;
            const voteValue = Number(btn.dataset.vote);
            submitVote(widget, voteValue).then(() => {
              const grid = widget.closest('.skills-grid[data-category-id]');
              const toolbar = document.querySelector('.sort-toolbar[data-category-id="' + widget.dataset.categoryId + '"]');
              const communityBtn = toolbar ? toolbar.querySelector('.sort-toggle-btn[data-sort-mode="community"]') : null;
              if (grid && communityBtn && communityBtn.classList.contains('is-active')) {
                applySortMode(grid, 'community');
              }
            });
          });
        });
      });

      document.querySelectorAll('.skills-grid[data-category-id]').forEach((grid) => {
        const categoryId = grid.dataset.categoryId;
        const toolbar = document.querySelector('.sort-toolbar[data-category-id="' + categoryId + '"]');
        if (!toolbar) return;
        bindSortToggle(toolbar, grid);
        applySortMode(grid, 'community');
      });
    });
  </script>
</body>
</html>